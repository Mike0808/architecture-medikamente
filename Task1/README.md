# Задание 1. Анализ безопасности системы

##  Какие конфиденциальные данные пропущены/неучтены

* Контакты пациентов вне Excel: переписка в почте (Exchange), мессенджеры, телефонные звонки (журналы звонков). Нет единого учёта согласий на обработку (consent) и статусов отзыва согласия.
* Медицинские документы: результаты анализов, заключения, направления — лежат как сканы/фото в произвольных папках; нет системного статуса (актуально/исправлено/отозвано).
* Логирование доступа: кто открывал карточку/скан/Excel — не фиксируется; нет trace на уровне файловой шары.
* Идентификаторы и кросс‑ссылки: нет стабильного patient_id, связки с визитами/услугами/платежами; высокая вероятность ошибочной корреляции данных разных людей.
* Метаданные согласий и сроков хранения: отсутствуют поля/реестр для сроков хранения, оснований обработки, категорий специальных данных (медицинские — повышенная чувствительность).
* Управление ключами/шифрованием: отсутствует.
  
## Аудит текущих мер безопасности
* Доменная аутентификация есть, но нет авторизации на уровне объектов (RBAC/ABAC к конкретным файлам/записям).
* Шифрование данных на диске/в каналах — отсутствует или не гарантируется, журналы и сканы лежат открыто.
* Логирование и аудит доступа к ПДн/медданным — отсутствуют.
* Процедуры Data Lifecycle (сроки хранения, архив, удаление, отзыв согласия) — не описаны и не автоматизированы.
* Резервное копирование — не покрывает выборочное восстановление карточек/файлов и контроль целостности.

## Проблемные зоны

1. Файловая шара как основное хранилище ЕМК (сканы/Excel)
   - Нет версионирования, блокировок и аудита
   - Лёгкая утечка (копирование, пересылка по почте)
   - Нет «need-to-know»: доступ широкий, не по ролям

2. Excel-журналы записи и списки пациентов
   - PII/медданные в явном виде, ошибки ввода, дубли
   - Конкурентное редактирование и потеря строк
   - Нет стабильных идентификаторов

3. 1С в файловом режиме (Бухгалтерия и Торговля/Склад)
   - Нет шифрования на уровне БД, слабый контроль доступа
   - Зависимость от файловых прав и сетевых шар
   - Нет централизованного аудита запросов

4. ККМ и интеграции без единой шины событий
   - TCP/IP + OLE без унифицированного журнала/трассировки
   - Ошибки синхронизации и расхождения с оплатами

5. Почта (Exchange) как транспорт ПДн
   - Вложения с ПДн без DLP
   - Нет централизованного контроля рассылок и сроков хранения

6. Отсутствие каталога данных и тегов чувствительности
   - Нет каталогов данных и сервисов авторизации
   - Невозможно задать политики доступа «по тегам»

7. Отсутствие шифрования и KMS
   - Нет Vault/HSM, нет TDE/Column-level crypto
   - Нет ротации ключей и разделения полномочий

8. Нет Data Lineage и SLA для интеграций
   - Не прослеживается источник → трансформация → потребитель
   - Нет формализованных контрактов с лабораторией

9. Нет регламентов Data Lifecycle и consent management
   - Не фиксируются согласия/отзыв согласий
   - Нет автоматического удаления по срокам хранения и по запросу

## Что улучшить

* Ввести единый идентификатор пациента, врача и модель данных (пациент, визит, услуга, платёж, документ, врач).
* Перейти от Excel/сканов к сервису электронной мед карты с формализованными сущностями, валидацией и историей изменений.
* Разнести PII/медицинские данные по доменам: PII‑data (идентификаторы, контакты), Clinical‑data (анамнез, назначения), Billing (оплаты), Inventory (ТМЦ).
* Ввести каталог данных + тегирование чувствительности, автоматические политики доступа (RBAC/ABAC), сквозной аудит.
* Везде включить шифрование: at rest + in transit; централизовать управление ключами.
* Настроить интеграции по API (портал пациента, лаборатория, 1С‑адаптер), запретить прямые файлопомойки.

### Список данных для защиты и способы

| Категория           | Примеры                        | Риск                  | Защита (минимум)                                                                      |
| ------------------- | ------------------------------ | --------------------- | ------------------------------------------------------------------------------------- |
| Идентификация (PII) | ФИО, ДР, телефон, email, адрес | деанонимизация        | шифрование БД (TDE), поле‑уровень (FPE/AES‑GCM), токенизация, маскирование в UI       |
| Медицинская тайна   | диагноз, анализы, назначения   | утечка спец.категории | шифр. на уровне сервиса, разнесение доменов, строгий RBAC/ABAC, mTLS, запрет экспорта |
| Платёжные           | суммы, чеки, привязка к визиту | мошенничество         | TLS 1.2, журнал доступа, неизменяемые логи                                            |
| Служебные логи      | события доступа                | раскрытие контента    | редактируемые поля очищать, хранить обезличенно                                       |
| Документы/сканы     | JPG, PDF заключений            | массовая утечка       | S3‑объекты с SSE‑KMS, presigned URLs, DLP                                             |

## Диаграмма движения данных
[Диаграмма движения данных](AsIsMedikamente.drawio)