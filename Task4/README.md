# Оценка узких мест при миграции

## Диаграмма Исикавы - Узкие места при миграции
[Исикава - Узкие места при миграции](Исикава%20-%20Узкие%20места%20при%20миграции.drawio)

## Выявленные проблемы и предложенные решения

1.  Интеграция и данные
    * Неверная токенизация/шифрование PII при миграции
    * Отсутствие Data Contracts/Schema Registry
    * Потеря истории при переносе из 1С/Excel
    * Несогласованность схем БД, несовместимые типы
    * Проблемы Data Catalog ошибки lineage, дублирование мета данных
  Рекомендации
    - Ввести единые data-contracts
    - Развернуть Data Catalog с lineage + Ranger для политики разрешений
    - Применить мягкую миграцию dry-run перед реальным переносом;
    - Создать из БД с ИОД золотой источник.
    - Передавать WAL Изменения в Kafka для реализации мгновенного реагирования на изменения в БД сервисов
2. Инфраструктура
   * Заниженные IOPS/ ограничения NVMe/ для S3 узкие места сети (e2e TLS, mTLS)
   * Нет HA/DR (кластер 1С, MinIO, PG)
   * Неверная аллокация CPU/RAM для Pod'ов
   * Нет балансировки/ingress‑лимитов и retry/circuit breaker
  Рекомендации
   - Тестировать IOPS и throughput заранее
   - Настроить HA 
   - Расчитать сайзинг для сервисов заранее
   - Проработать балансировку и сетевую оптимизацию
3. Процессы
   * Не формализованы data‑contracts у лаборатории/партнёров
   * Нет регламентов по ключам (Vault/KMS)
   * Нет CI/CD для миграций/проверки схем нет rollback‑плана
   * Отсутствует мониторинг SLA/алерты
   * Не сформирован процесс онлайн оплаты
  Рекомендации
   - Ввести полноценный CI/CD
        Для каждого сервиса:
        сборка;
        тесты;
        линтеры;
        проверка схем;
        деплой ArgoCD;
        автоматический rollback.
   - Без обновлённого data-contract код не принимается
   - Установить мониторинг SLA USE, 4 Google Gold Signal
   - Централизовать управление ключами
   -  Вести checklist миграций
4. Программное обеспечение
   * Разнобой SDK/драйверов (KC/PG/S3/Kafka)
   * Нет трассировки/корреляции (trace id)
   * Саги/идемпотентность не реализованы
   * Ошибки сериализации (JSON/Avro) 
  Рекомендации
   - Единая база библиотек 
   - Развернуть и прменить open-telemetry tracing;
   - Внедрить saga + идемпотентные операции
   - JSON/Avro миграции делать только через Schema Registry
5. Персонал
   * Сопротивление изменениям (1С‑пользователи)
   * Ручные деплои/откаты -> ошибки
   * Нет среды Dev/Stage для обучения/регресса
   * Недостаток компетенций Kubernetes/DevSecOps
   * Ошибки операторов
  Рекомендации
  - Обучить команду
  - Создать полноценный Dev/Stage с аналогичными компонентами
  - Убрать ручные операции Только GitOps — ArgoCD + CI.
  - Для 1С-персонала сделать плавное внедрение:
        тестовый стенд;
        расписание миграций;
        feature toggle.